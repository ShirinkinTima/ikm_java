
# Проект по ЯП 'Java'. Студент: Ширинкин Тимофей. Группа: ИТ-12
## 1. Функциональные возможности

Система предоставляет полный цикл управления бизнес-процессами автосервиса:

- **Журнал заказов (Dashboard):** Просмотр всех текущих работ с расчетом итоговой стоимости в реальном времени.
    
- **Умное создание заказов:** Возможность зарегистрировать нового клиента и новый автомобиль прямо в форме создания заказа без перехода в другие разделы.
    
- **Управление справочниками:** Полноценный CRUD (создание, чтение, обновление, удаление) для Клиентов, Автомобилей и Каталога услуг.
    
- **Защита целостности данных:** Блокировка удаления объектов, на которые ссылаются активные заказы.
    
- **Интеллектуальная защита от дубликатов:** Система автоматически проверяет уникальность по ключевым полям (телефон, госномер, уникальное сочетание параметров заказа).
    

---

## 2. Технологический стек

### Backend

- **Java 17/21:** Основной язык разработки.
    
- **Spring Boot 3.2.x:** Базовый фреймворк для управления конфигурацией и зависимостями.
    
- **Spring Data JPA (Hibernate):** ORM-фреймворк для работы с реляционной базой данных на уровне Java-объектов.
    
- **Spring Web:** Модуль для реализации MVC-архитектуры и обработки HTTP-запросов.
    
- **Jakarta Validation:** Аннотационная валидация данных (Bean Validation).
    

### Database

- **PostgreSQL:** Мощная реляционная СУБД.
    
- **JDBC Driver:** Технический драйвер для связи приложения с сервером БД.
    

### Frontend

- **Thymeleaf:** Серверный шаблонизатор для генерации динамического HTML-контента.
    
- **Bootstrap 5.3:** Фреймворк для адаптивной верстки интерфейса.
    
- **Bootstrap Icons:** Библиотека иконок для визуализации элементов управления.
    

### Utilities

- **Project Lombok:** Библиотека для сокращения шаблонного кода (автоматическая генерация геттеров, сеттеров и конструкторов).
    

---

## 3. Структура проекта

Проект организован согласно стандартам слоистой архитектуры Spring:

code Text

    `src/main/java/com/example/demo/ 
    ├── controllers/            # Слой обработки HTTP-запросов 
    │   ├── MainController      # Переадресация и навигация 
    │   ├── OrderController     # Логика управления заказами (Core logic) 
    │   ├── AdminController     # Управление справочниками (Клиенты, Авто, Услуги) 
    │   └── GlobalExceptionHandler # Глобальный перехват ошибок 
    ├── models/                 # Слой сущностей (Entities) 
    │   ├── Client              # Клиенты (ID, ФИО, Телефон) 
    │   ├── Vehicle             # Автомобили (ID, Модель, Госномер, Владелец) 
    │   ├── ServiceCatalog      # Услуги (ID, Название, Цена) 
    │   └── ServiceOrder        # Заказы (ID, Дата, Авто, Услуга, Статус) 
    ├── repositories/           # Слой доступа к данным (Spring Data JPA) 
    │   ├── ClientRepository 
    │   ├── VehicleRepository 
    ├── ServiceCatalogRepository 
    │   └── ServiceOrderRepository 
    └── DemoApplication.java    # Точка входа в приложение  
    src/main/resources/ 
    ├── templates/              # HTML-шаблоны Thymeleaf 
    │   ├── admin/              # Страницы справочников и их редактирования 
    │   ├── orders/             # Страницы журнала заказов и формы создания
    │   └── error-page.html     # Кастомная страница ошибок 
    ├── application.properties  # Конфигурация БД и приложения 
    └── data.sql                # Скрипт первичной инициализации данных`
  

---

## 4. Реализация базы данных и нормализация

База данных спроектирована в соответствии с принципами нормализации, что минимизирует избыточность данных:

1. **Связь One-to-Many (Клиент -> Авто):** У одного клиента может быть несколько автомобилей, но каждый автомобиль жестко привязан к одному владельцу.
    
2. **Связь Many-to-One (Заказ -> Авто/Услуга):** Множество заказов могут ссылаться на одну и ту же услугу или автомобиль.
    
3. **Составной уникальный индекс (Composite Unique Index):** В таблице service_order реализовано ограничение на уникальность тройки полей: order_date + vehicle_id + service_id. Это исключает возможность повторного занесения одной и той же работы по одной машине в один день.
    

---

## 5. Ключевые алгоритмы и решения

### Логика вложенного сохранения ("Матрешка")

В OrderController.save() реализован алгоритм каскадной проверки. Если при оформлении заказа пользователь ввел данные нового автомобиля:

1. Проверяется, является ли владелец новым. Если да — сохраняется Client.
    
2. Владелец привязывается к Vehicle. Сохраняется Vehicle.
    
3. Автомобиль привязывается к ServiceOrder. Сохраняется ServiceOrder.
    

### Обработка исключений

Использование @ControllerAdvice позволило централизованно обрабатывать все ошибки. При попытке удаления клиента, за которым числится авто, база данных выбрасывает DataIntegrityViolationException. Система перехватывает его и выводит пользователю понятное сообщение: "Нельзя удалить клиента: за ним числятся автомобили".

### Автозаполнение форм

При редактировании любого объекта (заказа, авто и т.д.) используется атрибут th:field. Это позволяет автоматически подставлять в форму сохраненные значения (включая даты и выбранные пункты выпадающих списков), избавляя пользователя от рутинного ввода.

---

## 6. Установка и запуск

1. **Требования:** Установленная JDK 17+ и PostgreSQL.
    
2. **База данных:** Создайте в PostgreSQL базу данных с именем ikm_database.
    
3. **Конфигурация:** В файле application.properties укажите ваш username и password для доступа к БД.
    
4. **Запуск:** Выполните команду ./mvnw spring-boot:run или запустите метод main из DemoApplication.java в вашей IDE.
    
5. **Доступ:** Откройте браузер по адресу http://localhost:8080.
    

---

## 7. Тестирование и демонстрация

Для проверки работоспособности системы рекомендуется выполнить следующие сценарии:

1. **Проверка дубликатов:** Попробуйте создать две одинаковые услуги с одним названием — система заблокирует вторую попытку.
    
2. **Проверка связей:** Попробуйте удалить услугу, которая уже есть в журнале заказов — система выдаст предупреждение о невозможности действия.
    
3. **Проверка создания "на лету":** При создании заказа нажмите переключатель "Новое авто", введите данные и убедитесь, что после сохранения заказа новая машина появилась во вкладке "Авто".
    
4. **Валидация:** Попробуйте сохранить заказ с пустой датой — поле подсветится красным цветом с требованием заполнения.
    

---
